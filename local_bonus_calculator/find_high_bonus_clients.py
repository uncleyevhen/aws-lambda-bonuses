#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ—à—É–∫—É –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –±–æ–Ω—É—Å–∞–º–∏
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º—É–ª—å—Ç–∏–ø—Ä–æ—Ü–µ—Å–æ—Ä–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
"""

import json
from keycrm_bonus_calculator import main, load_config

def setup_search_config(min_bonus_amount=3000):
    """–ù–∞–ª–∞—à—Ç–æ–≤—É—î –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –¥–ª—è –ø–æ—à—É–∫—É –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –±–æ–Ω—É—Å–∞–º–∏"""
    
    # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
    config = load_config()
    
    # –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —Ä–µ–∂–∏–º –ø–æ—à—É–∫—É
    config['search_mode'] = {
        'enabled': True,
        'only_search': True,  # –¢—ñ–ª—å–∫–∏ –ø–æ—à—É–∫, –±–µ–∑ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è
        'min_bonus_amount': min_bonus_amount
    }
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
    with open('config.json', 'w', encoding='utf-8') as f:
        json.dump(config, f, ensure_ascii=False, indent=2)
    
    print(f"‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –ø–æ—à—É–∫—É –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑ –±–æ–Ω—É—Å–∞–º–∏ ‚â• {min_bonus_amount}")
    return config

def restore_normal_config():
    """–í—ñ–¥–Ω–æ–≤–ª—é—î –∑–≤–∏—á–∞–π–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –ø—ñ—Å–ª—è –ø–æ—à—É–∫—É"""
    
    config = load_config()
    
    # –í–∏–º–∏–∫–∞—î–º–æ —Ä–µ–∂–∏–º –ø–æ—à—É–∫—É
    config['search_mode'] = {
        'enabled': False,
        'only_search': False,
        'min_bonus_amount': 3000
    }
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
    with open('config.json', 'w', encoding='utf-8') as f:
        json.dump(config, f, ensure_ascii=False, indent=2)
    
    print("‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –¥–æ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É")

if __name__ == "__main__":
    print("üîç –ü–û–®–£–ö –ö–õ–Ü–Ñ–ù–¢–Ü–í –ó –í–ï–õ–ò–ö–ò–ú–ò –ë–û–ù–£–°–ê–ú–ò")
    print("=" * 50)
    
    try:
        # –ó–∞–ø–∏—Ç—É—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–æ–Ω—É—Å—ñ–≤
        min_bonus = input("–í–≤–µ–¥—ñ—Ç—å –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–æ–Ω—É—Å—ñ–≤ –¥–ª—è –ø–æ—à—É–∫—É (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 3000): ").strip()
        
        if min_bonus:
            try:
                min_bonus_amount = int(min_bonus)
            except ValueError:
                print("‚ùå –ù–µ–≤—ñ—Ä–Ω–µ —á–∏—Å–ª–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é 3000")
                min_bonus_amount = 3000
        else:
            min_bonus_amount = 3000
        
        print(f"üîç –®—É–∫–∞—î–º–æ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑ –±–æ–Ω—É—Å–∞–º–∏ ‚â• {min_bonus_amount}")
        print()
        
        # –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –¥–ª—è –ø–æ—à—É–∫—É
        setup_search_config(min_bonus_amount)
        
        # –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–æ—à—É–∫
        main()
        
    except KeyboardInterrupt:
        print("\n‚ùå –ü–æ—à—É–∫ –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º")
    
    except Exception as e:
        print(f"\n‚ùå –ü–æ–º–∏–ª–∫–∞: {e}")
    
    finally:
        # –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∑–≤–∏—á–∞–π–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
        restore_normal_config()
        print("\nüîÑ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ")
